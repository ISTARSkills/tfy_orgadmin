<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<istar_reports>
<reports id="3040" type_of_report="column">	
	    <column columnHandler="NONE" display_name="Section Name" isVisible="true" name="name" />		
		<column columnHandler="NONE" display_name="rookie" isVisible="true" name="rookie" />
		<column columnHandler="NONE" display_name="apprentice" isVisible="true" name="apprentice" />
		<column columnHandler="NONE" display_name="master" isVisible="true" name="master" />
		<column columnHandler="NONE" display_name="wizard" isVisible="true" name="wizard" />
	<sql>
SELECT 	batch_group. NAME, 	CAST (SUM (master) * 100 / ( 		SUM (master) + SUM (rookie) + SUM (apprentice) + SUM (wizard) 	)AS INTEGER 	) AS master, 	CAST (SUM (rookie) * 100 / ( 		SUM (master) + SUM (rookie) + SUM (apprentice) + SUM (wizard) 	)AS INTEGER 	) AS rookie, 	CAST (SUM (apprentice) * 100 / ( 		SUM (master) + SUM (rookie) + SUM (apprentice) + SUM (wizard) 	)AS INTEGER 	) AS apprentice, CAST ( 	SUM (wizard) * 100 / (  		SUM (master) + SUM (rookie) + SUM (apprentice) + SUM (wizard) 	)AS INTEGER 	) AS wizard FROM 	mastery_level_per_course, 	batch_group WHERE 	mastery_level_per_course.college_id = :college_id AND course_id = :course_id AND batch_group. ID = mastery_level_per_course.batch_group_id GROUP BY 	batch_group. NAME		</sql>
	<filter_sql>
		
	</filter_sql>	
		<title>Section Wise Performance of Students</title>
		<y_axis_title>Number of Students</y_axis_title>
</reports>
<reports id="3041" type_of_report="column">	
	    <column columnHandler="NONE" display_name="Course Name" isVisible="true" name="course_name" />		
		<column columnHandler="NONE" display_name="rookie" isVisible="true" name="rookie" />
		<column columnHandler="NONE" display_name="apprentice" isVisible="true" name="apprentice" />
		<column columnHandler="NONE" display_name="master" isVisible="true" name="master" />
		<column columnHandler="NONE" display_name="wizard" isVisible="true" name="wizard" />
	<sql>
SELECT 	course.course_name, 	CAST (AVG(master) * 100 AS INTEGER) AS master, 	CAST (AVG(rookie) * 100 AS INTEGER) AS rookie, 	CAST ( 		AVG (apprentice) * 100 AS INTEGER 	) AS apprentice, 	CAST (AVG(wizard) * 100 AS INTEGER) AS wizard, 	CAST ( 		( 			AVG (master) + AVG (rookie) + AVG (apprentice) + AVG (wizard) 		) AS INTEGER 	) AS total FROM 	mastery_level_per_course, 	course WHERE 	 mastery_level_per_course.college_id = :college_id AND batch_group_id = :batch_group_id AND course. ID = mastery_level_per_course.course_id GROUP BY 	course.course_name ORDER BY 	total		</sql>
	<filter_sql>
		
	</filter_sql>	
		<title>Program Wise Performance of Students</title>
		<y_axis_title>Number of Students</y_axis_title>
</reports>
<reports id="3042" type_of_report="table">	
	    <column columnHandler="NONE" display_name="Id" isVisible="true" name="id" />		
		<column columnHandler="PROFILE_IMAGE" display_name="Profile Image" isVisible="true" name="profile_image" />
		<column columnHandler="NONE" display_name="First Name" isVisible="true" name="first_name" />
		<column columnHandler="NONE" display_name="Email" isVisible="true" name="email" />
		<column columnHandler="STAR_RATING" display_name="Attendance" isVisible="true" name="atten_perc" />
		<column columnHandler="NONE" display_name="Batch Groups" isVisible="true" name="batch_groups" />		
		<column columnHandler="USER_HANDLER" display_name="Action" isVisible="true" name="id"/>		
	<sql>
SELECT
	profile_image,
	first_name,
	(case when atten_perc is not null then
						
					case 
					when atten_perc 	&lt;= 20 then 1
					when atten_perc 	&gt; 20 and atten_perc &lt;=40 then 2
					when atten_perc 	&gt; 40 and atten_perc &lt;=60 then 3
          when atten_perc 	&gt; 60 and atten_perc &lt;=80 then 4
          when atten_perc 	&gt; 80 and atten_perc &lt;=100 then 5
					end
		else 0
	end ) as atten_perc,
	email,
	batch_groups,
	ID,
	courses,
	course_ids, count(*) OVER() as total_rows
FROM
	(
		SELECT
			istar_user. ID,
			user_profile.first_name,
			istar_user.email,
			CASE
		WHEN user_profile.profile_image LIKE 'null'
		OR user_profile.profile_image IS NULL THEN
			'http://api.talentify.in/video/android_images/' || UPPER (
				SUBSTRING (
					user_profile.first_name
					FROM
						1 FOR 1
				)
			) || '.png'
		ELSE
			'http://api.talentify.in/' || user_profile.profile_image
		END AS profile_image,
		string_agg (
			DISTINCT (batch_group. NAME),
			', '
		) AS batch_groups,
		string_agg (DISTINCT(course_name), ', ') AS courses,
		string_agg (
			DISTINCT (
				CAST (batch_group. ID AS VARCHAR)
			),
			', '
		) AS batch_group_ids,
		string_agg (
			DISTINCT (CAST(course. ID AS VARCHAR)),
			', '
		) AS course_ids
	FROM
		course,
		batch,
		batch_group,
		istar_user,
		batch_students,
		user_profile,
		user_org_mapping
	WHERE
		user_org_mapping.organization_id = :college_id
	AND user_org_mapping.user_id = istar_user. ID
	AND istar_user. ID = batch_students.student_id
	AND batch_students.batch_group_id = batch_group. ID
	AND batch_group.college_id =:college_id
	AND user_profile.user_id = istar_user. ID
	AND batch_group. ID = batch.batch_group_id
	AND batch.course_id = course. ID
	GROUP BY
		istar_user. ID,
		user_profile.first_name,
		istar_user.email,
		user_profile.profile_image
	) T1
LEFT JOIN (
	SELECT
		user_id,
		COALESCE (
			CAST (
				(
					(
						COUNT (*) FILTER (

							WHERE
								attendance.status = 'ABSENT'
						)
					) * 100 / (
						COUNT (*) FILTER (

							WHERE
								attendance.status = 'ABSENT'
							OR attendance.status = 'PRESENT'
						)
					)
				) AS INTEGER
			),
			0
		) AS atten_perc
	FROM
		attendance
	WHERE
		user_id IN (
			SELECT
				istar_user. ID
			FROM
				istar_user,
				user_org_mapping
			WHERE
				istar_user. ID = user_org_mapping.user_id
			AND user_org_mapping.organization_id = :college_id
		)
	GROUP BY
		user_id
) T2 ON (T1. ID = T2.user_id) order by :order_by_column :order_type limit :limit offset :offset

		</sql>
	<filter_sql>
		
	</filter_sql>	
		<title>Section Wise Performance of Students</title>
		<y_axis_title>Number of Students</y_axis_title>
</reports>



</istar_reports>
